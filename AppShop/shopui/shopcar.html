<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>购物车</title>
		<link rel="stylesheet" type="text/css" href="css/loaders.min.css" />
		<link rel="stylesheet" type="text/css" href="css/loading.css" />
		<link rel="stylesheet" type="text/css" href="css/base.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<style>
			
		</style>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript">
			mui.back = function back() {
				//首次按键，提示‘再按一次退出应用’
				history.go(-1)
			}
		</script>
		<script type="text/javascript">
			$(window).load(function() {
				$(".loading").addClass("loader-chanage")
				$(".loading").fadeOut(300)
			})
		</script>
	</head>
	<!--loading页开始-->
	<div class="loading">
		<div class="loader">
			<div class="loader-inner pacman">
				<div></div>
				<div></div>
				<div></div>
				<div></div>
				<div></div>
			</div>
		</div>
	</div>
	<!--loading页结束-->
	<body>
		<header class="page-header">
			<h3>购物车</h3>
		</header>
		<div class="mui-content">
			<ul id="OA_task_1" class="mui-table-view">
				<li class="mui-table-view-cell  mui-media">
					<div class="mui-slider-right mui-disabled">
						<a class="mui-btn mui-btn-red">删除</a>
					</div>
					<div class="mui-slider-handle">
						<img class="mui-media-object mui-pull-left" style="line-height: 100px;max-width: 100px;height: 100px;" src="images/shopcar-ph01.png">
						<div class="mui-media-body">
							<dl>
								<dt id="title">超级大品牌服装，现在买只要998</dt>
								购买数量:
								<div class="mui-numbox" data-numbox-min='1' >
									<button class="mui-btn mui-btn-numbox-minus" type="button">-</button>
									<input class="mui-input-numbox" type="number" value="1"/>
									<button class="mui-btn mui-btn-numbox-plus" type="button">+</button>
								</div>					
								<dd id="price"><span>单价：</span>￥653.00</dd>
								<h3 id="totalprice" style="">￥653.00</h3>
							</dl>
						</div>
					</div>
				</li>
			</ul>
		</div>

		<!-- <div class="contaniner fixed-contb">
			<section class="shopcar">
				<figure style="margin: 0px;"><img src="images/shopcar-ph01.png" /></figure>
				<dl>
					<dt id="title">超级大品牌服装，现在买只要998</dt>
					购买数量:
					<div class="mui-numbox" data-numbox-min='1' >
						<button class="mui-btn mui-btn-numbox-minus" type="button">-</button>
						<input class="mui-input-numbox" type="number" value="1"/>
						<button class="mui-btn mui-btn-numbox-plus" type="button">+</button>
					</div>					
					<dd id="price"><span>单价：</span>￥653.00</dd>
					<h3 id="totalprice" style="">￥653.00</h3>
					<small><img src="images/shopcar-icon01.png"/></small>
				</dl>
			</section>

			<div style="margin-bottom: 16%;"></div>
		</div> -->
		<script type="text/javascript">
			$(".shopcar-checkbox label").on('touchstart', function() {
				if ($(this).hasClass('shopcar-checkd')) {
					$(".shopcar-checkbox label").removeClass("shopcar-checkd")
				} else {
					$(".shopcar-checkbox label").addClass("shopcar-checkd")
				}
			})
		</script>
		<footer class="page-footer fixed-footer">
			<div class="shop-go">
				<b>合计：￥108.90</b>
				<span><a href="buy.html">去结算（2）</a></span>
			</div>
			<ul>
				<li>
					<a href="index.html">
						<img src="images/footer001.png" />
						<p>首页</p>
					</a>
				</li>

				<li class="active">
					<a href="shopcar.html">
						<img src="images/footer03.png" />
						<p>购物车</p>
					</a>
				</li>
				<li>
					<a href="../main.html" style="    border: 3px solid #ccc;border-radius: 50%;text-align: center;
			vertical-align: middle;margin: auto;line-height: 40px;">
						<p style="margin-top: 0;">主页</p>
					</a>
				</li>
				<li>
					<a href="assort.html">
						<img src="images/footer002.png" />
						<p>订单</p>
					</a>
				</li>
				<li>
					<a href="self.html">
						<img src="images/footer004.png" />
						<p>个人中心</p>
					</a>
				</li>
			</ul>
		</footer>


	</body>
	<script src="../js/app.js"></script>
	<script src="../js/config.js"></script>
	<script src="../js/data.js"></script>
	<script>
		var userInfo = {};
		$(function() {
			userInfo = app.getSettings();
			var id = getQueryVariable("id");
			localStorage.setItem('$ProdID', id)
			var data = {
				"ReqSys": config.reqSys,
				"ReqKey": userInfo.UserID,
				"ReqPwd": userInfo.PwdTmp,
				"ReqType": "ScProdGet",
				"ReqData": id
			};
			jqAjax(data, initPage);

			$('#addShopCar').on('click', function() {
				var param = {
					"ReqSys": config.reqSys,
					"ReqKey": userInfo.UserID,
					"ReqPwd": userInfo.PwdTmp,
					"ReqType": "ScShopCartUp",
					"ReqData": {
						"ProdID": id, // 商品ID
						"ProdNum": 1 // 商品数量，小于等于0时，表示删除，否则表示添加或修改
					}
				};
			});
		});

		function initPage(data) {
			console.log(JSON.stringify(data));

			var contain = document.getElementById('imgContain');
			contain.innerHTML = "";
			var li = document.createElement('li');
			li.className = 'swiper-slide';

			var html = "<a href=\"#\">";
			html += "<img src=\"" + data.RetData[0].PicMain + "\" />";
			html += "</a>";
			li.innerHTML = html;
			contain.appendChild(li);

			var money = document.getElementById('money');
			money.innerHTML = data.RetData[0].PPrice;
			var title = document.getElementById('title');
			title.innerHTML = data.RetData[0].PExplain;
			var jf = document.getElementById('jf');
			jf.innerHTML = data.RetData[0].PInteg;
		}
		
		function jqAjax() {
			var arg = arguments;
			$.ajax({
				async: true, //表示请求是否异步处理
				timeout: 50000,
				type: "post", //请求类型
				url: config.url, //请求的 URL地址
				data: JSON.stringify(arg[0]),
				contentType: "application/json",
				dataType: "json", //返回的数据类型
				success: function(data) {
					console.log(JSON.stringify(data)); //在控制台打印服务器端返回的数据						
					if (data.RetFlag < 0) {
						mui.toast(data.RetInfo);
						return;
					} else {
						if (typeof arg[1] === "function") {
							//调用它，既然我们已经确定了它是可调用的
							callback = arg[1];
							callback(data);
						}
					}
				},
				error: function(data) {
					console.log(JSON.stringify(data));
					mui.toast(tempJson.common.error[config.reqSys] + "（" + data.ReqType + "）");
				}
			});
		}
	</script>
	<!--App自定义的css-->
	<link rel="stylesheet" type="text/css" href="../css/app.css" />
	<script>
		mui.init();
		(function(mui) {
			mui('#OA_task_1').on('tap', '.mui-slider-right .mui-btn', function(event) {
				var elem = this;
				var li = elem.parentNode.parentNode;
				mui.confirm('确认删除该条记录？', 'eternal', btnArray, function(e) {
					if (e.index == 0) {
						var param = {
							"ReqSys": config.reqSys,
							"ReqKey": userInfo.UserID,
							"ReqPwd": userInfo.PwdTmp,
							"ReqType": "ScShopCartUp",
							"ReqData": {
								"ProdID": id, // 商品ID
								"ProdNum": 0 // 商品数量，小于等于0时，表示删除，否则表示添加或修改
							}
						};						
						$.ajax({
							async: true, //表示请求是否异步处理
							timeout: 50000,
							type: "post", //请求类型
							url: config.url, //请求的 URL地址
							data: JSON.stringify(param),
							contentType: "application/json",
							dataType: "json", //返回的数据类型
							success: function(data) {
								console.log(JSON.stringify(data)); //在控制台打印服务器端返回的数据						
								if (data.RetFlag < 0) {
									mui.toast(data.RetInfo);
									return;
								} else {
									li.parentNode.removeChild(li);
								}
							},
							error: function(data) {
								console.log(JSON.stringify(data));
								mui.toast(tempJson.common.error[config.reqSys] + "（" + data.ReqType + "）");
							}
						});			
					} 
					else {
						setTimeout(function() {
							mui.swipeoutClose(li);
						}, 0);
					}
				});
			});
			var btnArray = ['确认', '取消'];
		})(mui);
	</script>
</html>
